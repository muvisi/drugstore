<div class="card">
    <div class="card-header">
      <h5>
        Book Room
        <button  class="btn btn-success  btn-sm pull-right" (click)="mpesa()">Mpesa STK</button>
      </h5>
    </div>
    <div class="card-body">
        <form [formGroup]="bookingForm" (ngSubmit)="onBook()">
            <div class="row">
                <div class="col-sm-3">
                    <mat-form-field appearance="outline">
                        <mat-label>Name</mat-label>
                        <input matInput placeholder="Name" formControlName="name" readonly >
                        <mat-error *ngIf="f.name && submitted">Room Name <strong>required</strong></mat-error>

                      </mat-form-field>
                </div>
                <div class="col-sm-3">
                    <mat-form-field appearance="outline">
                        <mat-label>Type</mat-label>
                        <input matInput placeholder="Room Type" formControlName="type_name" readonly >
                        <mat-error *ngIf="f.type_name && submitted"> Cost <strong>required</strong></mat-error>

                      </mat-form-field>
                </div>
                <div class="col-sm-2">
                    <mat-form-field appearance="outline">
                        <mat-label>Cost</mat-label>
                        <input matInput placeholder="Name" formControlName="cost"  readonly>
                        <mat-error *ngIf="f.cost && submitted"> Cost <strong>required</strong></mat-error>

                      </mat-form-field>
                </div>
               
                <div class="col-sm-2">
                    <mat-form-field appearance="outline">
                        <mat-label>Floor</mat-label>
                        <input matInput placeholder="Name" formControlName="floor"  readonly >
                        <mat-error *ngIf="f.floor && submitted"> Floor <strong>required</strong></mat-error>

                      </mat-form-field>
                </div>
                <div class="col-sm-12">
                    <mat-form-field appearance="outline">
                        <mat-label>Description</mat-label>
                        <textarea name="" id="" cols="30" rows="3" matInput placeholder="Name" formControlName="description" readonly></textarea>
                        <mat-error *ngIf="f.description && submitted"> description <strong>required</strong></mat-error>

                      </mat-form-field>
                </div>

                <div class="col-sm-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Counselor</mat-label>
                      <mat-select formControlName="staff">
                        <mat-option *ngFor="let item of counsolers" [value]="item.id">
                            {{item.first_name}} {{item.last_name}}
                        </mat-option>
                       
                      </mat-select>
                      <mat-error *ngIf="f.counselor?.errors && submitted">Counsellor is <strong>required</strong></mat-error>
                    </mat-form-field>
                  </div>
                <div class="col-sm-3">
                  <mat-form-field appearance="outline">
                    <mat-label>Choose Date</mat-label>
                      <input matInput placeholder="Date" [min]="date" formControlName="date" [matDatepicker]="picker">
                      <mat-error *ngIf="f.date?.errors">Date <strong>required</strong></mat-error>
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-sm-2">
                    <mat-form-field appearance="outline">
                        <mat-label>Time</mat-label>
                        <input matInput placeholder="Time" formControlName="time"  data-clocklet="class-name: my-clocklet-style;format:HH:mm;placement:top">
                        <mat-error *ngIf="f.time?.errors && submitted">Appointment Time <strong>required</strong></mat-error>
    
                      </mat-form-field>
                </div>
                <div class="col-sm-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Payment Type</mat-label>
                      <mat-select formControlName="payment_type">
                        <mat-option  value="Cash">
                        Cash
                        </mat-option>
                        <mat-option  value="Mpesa">
                        Mpesa
                        </mat-option>
                      </mat-select>
                      <mat-error *ngIf="f.payment_type && submitted">Payment Type <strong>required</strong></mat-error>
                    </mat-form-field>
                  </div>
                <div class="col-sm-3" *ngIf="f.payment_type.value == 'Mpesa'">
                    <mat-form-field appearance="outline">
                        <mat-label>Mpesa Transaction</mat-label>
                        <input matInput placeholder="Transaction" [typeahead]="transactions"  typeaheadOptionField="phone_number" (typeaheadOnSelect)="typeaheadOnSelect($event)"  [disabled]="f.payment_type.value == 'Cash'" (ngModelChange)="searchTransaction(f.no.value)" formControlName="no">
                        <mat-error *ngIf="f.no?.errors && submitted">Transaction <strong>required</strong></mat-error>
                      </mat-form-field>
                </div>
                <div class="col-sm-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Amount</mat-label>
                        <input matInput placeholder="Amount"  formControlName="amount">
                        <mat-error *ngIf="f.amount.errors && submitted">
                          <div *ngIf="f.amount?.errors">Amount is required</div>
                          <div *ngIf="f.amount.errors.min">Minimum amount is 10/=</div>
                        </mat-error>
                      </mat-form-field>
                  </div>
                <div class="col-sm-12" style="text-align: center;">
                  <button class="btn btn-success btn-sm" [disabled]="bookingForm.invalid">Submit</button>
                </div>
              
            </div>
          </form>

     
    </div>



  </div>


  <div class="modal fade" bsModal #staticModal="bs-modal" [config]="{backdrop: 'static'}"
     tabindex="-1" role="dialog" aria-labelledby="dialog-static-name">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="dialog-static-name" class="modal-title pull-left">Mpesa Payment Request</h5>
        <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="staticModal.hide()">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="paymentForm" (ngSubmit)="onPayment()">
          <div class="row">
              <div class="col-sm-12">
                  <mat-form-field appearance="outline">
                      <mat-label>Phone Number</mat-label>
                      <input matInput placeholder="Phone Number" formControlName="mobile" >
                      <mat-error *ngIf="p.mobile?.errors && submitted">Mobile <strong>required</strong></mat-error>

                    </mat-form-field>
              </div>
              
              <div class="col-sm-12">
                  <mat-form-field appearance="outline">
                    <mat-label>Amount</mat-label>
                      <input matInput placeholder="Amount" type="number"  formControlName="amount" readonly>
                      <mat-error *ngIf="p.amount.errors && submitted">
                        <div *ngIf="p.amount?.errors">Amount is required</div>
                        <div *ngIf="p.amount.errors.min">Minimum amount is 10/=</div>
                      </mat-error>
                    </mat-form-field>
                </div>
              <div class="col-sm-12" style="text-align: center;">
                <button class="btn btn-success btn-sm" [disabled]="paymentForm.invalid">Submit</button>
              </div>
            
          </div>
        </form>
      </div>
    </div>
  </div>
</div>