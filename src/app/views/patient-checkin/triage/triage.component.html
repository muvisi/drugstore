<div class="row">
  
  <div class="col-sm-12">
     
      <mat-horizontal-stepper>
          
          <mat-step label="Vitals" state="phone">
              <div class="row">
                  <div class="col-sm-12" *ngIf="(patient | keyvalue)?.length">
                      <h5 class="pull-right"> <b>NAME </b>:<span class="text-primary"><b>{{patient?.name | uppercase}}</b></span> <span class="text-success">
                       <b> | VISIT NO : {{patient?.visit_no}}</b>
                      </span></h5>
                    </div>
              </div>
              <div class="row">
                  <div class="col-sm-4">
                   
                      <mat-radio-group [(ngModel)]="priority" name="priority">
                      <div class="row">
                        <div class="col-sm-4">
                          <mat-radio-button value="3" checked>Normal</mat-radio-button>
                        </div>
                        
                        <div class="col-sm-4">
                    
                          <mat-radio-button  value="2">Urgent</mat-radio-button>
                        </div>
                        <div class="col-sm-4">
                            <mat-checkbox  (change)="status =!status" [checked]='true'>
                              Proceed to doctor
                            </mat-checkbox>
                          </div>
                      </div>
                    </mat-radio-group>
                    
                    </div>
                    
              </div>
          <div class="row">
            <div class="col-sm-12">
                <form [formGroup]="triageForm" novalidate>
                    
                    <div class="row">
                    <div class="col-sm-2">
                       <mat-form-field>
                           <input matInput placeholder="Temperature value" type="number" formControlName="temperature" [ngClass]="{ 'is-invalid': submitted && f.temperature.errors }" >
                           <i matSuffix class="fa fa-thermometer-half"></i>
                           
                           
                         </mat-form-field>
                    </div>
                    <div class="col-sm-2">
                       <mat-form-field>
                           <input matInput placeholder="Pulse rate" type="number" formControlName="pulse"  [ngClass]="{ 'is-invalid': submitted && f.pulse.errors }">
                           <i matSuffix class="fa fa-heartbeat"></i>
                         </mat-form-field>
                    </div>
                    <div class="col-sm-3">
                       <mat-form-field >
                           <input matInput placeholder="Blood Pressure (systolic)" type="number" (ngModelChange)="test()"  formControlName="systolic"  [ngClass]="{ 'is-invalid': submitted && f.systolic.errors }">
                           <i matSuffix class="fa fa-yelp"></i>
                         </mat-form-field>
                    </div>
                    <div class="col-sm-3">
                       <mat-form-field >

                           <input matInput placeholder="Blood Pressure (diastolic)" type="number" (ngModelChange)="test()" formControlName="diastolic"  [ngClass]="{ 'is-invalid': submitted && f.diastolic.errors }">
                           <i matSuffix class="fa fa-yelp"></i>
                      
                         </mat-form-field>
                    </div>
                    <div class="col-sm-2">
                       <mat-form-field >
                           
                           <input matInput placeholder="Blood pressure(mm/Hg)"  [value]="pressure" type="text" formControlName="blood_pressure"    readonly>
             
                         </mat-form-field>
                    </div>
                </div>
                <div class="row">
                       <div class="col-sm-2">
                               <mat-form-field>
                                  
                                   <input matInput placeholder="Height(cm)" type="number" (ngModelChange)="calculateBmi()" formControlName="height"  [ngClass]="{ 'is-invalid': submitted && f.height.errors }">
                                   <i matSuffix class="fa fa-yelp"></i>
                                 </mat-form-field>
                            </div>  
            
                            <div class="col-sm-2">
                                   <mat-form-field >
                  
                                       <input matInput placeholder="Weight(kgs)" type="number" (ngModelChange)="calculateBmi()" formControlName="weight"  [ngClass]="{ 'is-invalid': submitted && f.weight.errors }">
                                       <i matSuffix class="fa fa-yelp"></i>
                                     </mat-form-field>
                                </div>     
                                <div class="col-sm-2">
                                    <mat-form-field >
                                        <input matInput placeholder="BMI" [value]="bmi"  formControlName="bmi"   readonly>
                                        
                                      </mat-form-field>
                                 </div>   
                                <div class="col-sm-2">
                                       <mat-form-field >
                                           
                                           <input matInput placeholder="Respiratory" type="number" formControlName="respiratory"  [ngClass]="{ 'is-invalid': submitted && f.respiratory.errors }">
                                          
                                     
                                         </mat-form-field>
                                    </div>  
                                    <div class="col-sm-2">
                                        <mat-form-field >
                                            <input matInput placeholder="SpO"   formControlName="spo">
                                            
                                          </mat-form-field>
                                     </div> 
                                     <div class="col-sm-2">
                                        <mat-form-field >
                                            <input matInput placeholder="Lmp"   formControlName="lmp">
                                            
                                          </mat-form-field>
                                     </div>   
                                    <div class="col-sm-2">
                                        <mat-form-field >
                                            <input matInput placeholder="Head circumfrence"   formControlName="head_circumfrence">
                                           
                                          </mat-form-field>
                                     </div> 
                                     
                                     <div class="col-sm-2">
                                        <mat-form-field >
                                            <input matInput placeholder="Random Sugar Test"   formControlName="random_sugar">
                                            
                                          </mat-form-field>
                                     </div>  
                                     <div class="col-sm-2">
                                        <mat-form-field>
                                            <input matInput [(ngModel)]="observations.symptoms_onset"  [ngModelOptions]="{standalone: true}" placeholder="Onset of Symptoms" bsDatepicker [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }" >
                                          </mat-form-field>
                                    </div>
                                    <div class="col-sm-2">
                                        <mat-form-field>
                                            <input matInput placeholder="Next Appointment" bsDatepicker [ngModelOptions]="{standalone: true}" [(ngModel)]="observations.appointment_date" [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }">
                                          </mat-form-field>
                                    </div>                     
                                   
                </div>
                      </form>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
             
                <span><u><b>Observations</b></u></span>
                
                    <div class="row">
                        <div class="col-sm-2" *ngFor="let item of observationList" >
                          <mat-checkbox (change)="addObservation(item.name)" [checked]="existObs(item.name)">{{item.name}}</mat-checkbox>
                        </div>
                      </div>
                      <div class="row" style="margin-top: 10px;">
                        <div class="col-sm-6">
                          <mat-card>
                            <mat-card-subtitle>PAIN LEVEL</mat-card-subtitle>
                            <div class="row" style="margin-top: 20px">
                                <div class="col-sm-4">
                                    <mat-label>Risk of fall <span  *ngIf="value" class="text-danger">({{value}})</span></mat-label>
                                    
                                    <mat-slider
                                    thumbLabel
                                    [(ngModel)]="value"
                                    [displayWith]="formatLabel"
                                    tickInterval="1"
                                    min="1"
                                    max="10"></mat-slider>
                                      </div>
                                      <div class="col-sm-4">
                                          <mat-label>Pain Levels <span  *ngIf="painlevel" class="text-danger">({{painlevel}})</span></mat-label>
                                          
                                          <mat-slider
                                          thumbLabel
                                          [(ngModel)]="painlevel"
                                          [displayWith]="formatLabel"
                                          tickInterval="1"
                                          min="1"
                                          max="10"></mat-slider>
                                      </div>
                                      
                            </div>
                          </mat-card>
                        </div>
                        <div class="col-sm-6">
                          <mat-card>
                            <mat-card-subtitle>Nurse Notes</mat-card-subtitle>
                            
                                  <div class="col-sm-12">
                                      <mat-form-field>
                                          <textarea matInput placeholder="Write Observation notes" [(ngModel)]="observations.notes"></textarea>
                                          <i class="icon-note" matSuffix></i>
                                        </mat-form-field>
                                  </div>
                           
                          </mat-card>
                        </div>
                      </div>
                 
              

            </div>
          </div>
         <br>
            <div>
              <button mat-raised-button matStepperNext class="pull-right" >Next</button>
              <button mat-raised-button class="pull-right" class="btn btn-success btn-sm pull-right" style="margin-right: 6px;" (click)="onSubmit()"> <i class="fa fa-check"></i> Submit</button>
            </div>
          </mat-step>
          <mat-step label="Allergies" state="chat">
              <div class="row">
                  <div class="col-sm-12">
                     <mat-card>
                       <mat-card-title>Allergic Drugs</mat-card-title>
                        <div class="row">
                            <div class="col-sm-2">
                                <mat-form-field>
                                    <input matInput placeholder="Type Drug Name" [typeahead]="drugs" [(ngModel)]="name"
                                    (typeaheadLoading)="searchPrescription(name)"
                                    (typeaheadOnSelect)="onDrug($event)"
                                    [typeaheadOptionsLimit]="7"
                                    typeaheadOptionField="name"
                                     typeaheadGroupField="strength" [typeaheadOptionsInScrollableView]="4" >
                                  </mat-form-field>
                            </div>   
                        </div>

                        <div class="row">
                            <div class="col-sm-2" *ngFor="let item of allergicDrugs">
                            <i class="fa fa-check text-success"></i> <span style="font-weight: 500;font-size: 12px">{{item | uppercase}}</span>
                            </div>
                       </div>
                       
                     </mat-card>
                  </div>
                </div>
            <br>  
          <div class="row">
            <div class="col-sm-12">
              <mat-card>
                <div class="row">
                  <div class="col-sm-12">
                   <div class="row">
                     <div class="col-sm-6">
                      <h6><u>FOOD ALLERGY</u></h6>

                    <div class="row">
                        <div class="col-sm-2" *ngFor="let allergy of foodAllergies">
                                <mat-checkbox (change)="addAllergy(allergy.name)" [checked]="existAllergy(allergy.name)">{{allergy.name | uppercase}}</mat-checkbox>
                            </div>
                  </div>
                     </div>
                     <div class="col-sm-6">
                        <h6> <u>METAL ALLERGIES</u></h6>
                      <div class="row">
                            <div class="col-sm-2" *ngFor="let allergy of metalAllergies">
                                    <mat-checkbox (change)="addAllergy(allergy.name)" [checked]="existAllergy(allergy.name)">{{allergy.name | uppercase}}</mat-checkbox>
                                </div>
                      </div>
                     </div>
                   </div>
                  </div>

                  <div class="col-sm-12">
                    <h6><u>INSECT BITES ALLERGIES</u></h6>
                    <div class="row">
                        <div class="col-sm-2" *ngFor="let allergy of insectAllergies">
                                <mat-checkbox (change)="addAllergy(allergy.name)" [checked]="existAllergy(allergy.name)">{{allergy.name | uppercase}}</mat-checkbox>
                            </div>
                  </div>
                  </div>
                </div>
              </mat-card>

            </div>
          </div>
            <br>
            <div>
              
              <button mat-raised-button matStepperNext class="pull-right">Next</button>
              <button mat-raised-button matStepperPrevious class="pull-right" style="margin-right:10px">Back</button>
              <button mat-raised-button  class="pull-right btn btn-success" style="margin-right: 6px;" (click)="onSubmit()"> <i class="fa fa-check"></i>Submit</button>

            </div>
          </mat-step>
          <mat-step label="Triage Medicine">
            <br>
              <div class="row">
                  <div class="col-sm-12">
                     <mat-card>
                       <mat-card-title>Triage Medicine
                       </mat-card-title>
                        <div class="row">
                            <div class="col-sm-2">
                                <mat-form-field>
                                    <input matInput placeholder="Type Drug Name" [typeahead]="drugs" [(ngModel)]="selectedDrug.name"
                                    (typeaheadLoading)="searchPrescription(selectedDrug.name)"
                                    (typeaheadOnSelect)="onSelect($event)"
                                    [typeaheadOptionsLimit]="7"
                                    typeaheadOptionField="name"
                                     typeaheadGroupField="strength" [typeaheadOptionsInScrollableView]="4" >
                                  </mat-form-field>
                            </div>
                           
                            <div class="col-sm-2">
                                <mat-form-field>
                                  <input type="text" [(ngModel)]="selectedDrug.strength" placeholder="Drug Strength" matInput>
                                </mat-form-field>
      
                              </div>
                              <div class="col-sm-2">
                                  <mat-form-field>
                                    <input type="text" [(ngModel)]="selectedDrug.cost" placeholder="Cost" matInput>
                                  </mat-form-field>
        
                                </div>
                                <div class="col-sm-2">
                                    <mat-form-field>
                                      <input type="text" [(ngModel)]="selectedDrug.quantity" placeholder="Quantity" matInput>
                                    </mat-form-field>
          
                                  </div>
                              
                                <!-- <div class="col-sm-2">
                                    <mat-form-field>
                                        <mat-label>Dosage</mat-label>
                                        <mat-select [(ngModel)]="selectedDrug.dosage">
                                          <mat-option *ngFor="let item of dosage"  [value]="item.meaning">
                                            {{item.meaning}}
                                          </mat-option>
                                        </mat-select>
                                      </mat-form-field> 
                                </div> -->
                                <div class="col-sm-2">
                                    <mat-form-field>
                                      <input type="text" [(ngModel)]="selectedDrug.form" placeholder="Drug Form" matInput>
                                    </mat-form-field>
          
                                  </div>
                                  <div class="col-sm-2">
                                      <button mat-mini-fab (click)="addTriageMedicine()" [disabled]="!selectedDrug.name"> <i class="fa fa-plus"></i> </button>
                                  </div>
                                  
                                
                        </div>
                        
                          <br>
                        <div class="row">
                          <div class="col-sm-12" *ngIf="triageMedicine.length">

                            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

                                <ng-container matColumnDef="name">
                                  <th mat-header-cell *matHeaderCellDef>Name</th>
                                  <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                                </ng-container>
                                <ng-container matColumnDef="generic_name">
                                    <th mat-header-cell *matHeaderCellDef>Generic Name</th>
                                    <td mat-cell *matCellDef="let element"> {{element.generic_name}} </td>
                                  </ng-container>
                                <ng-container matColumnDef="strength">
                                  <th mat-header-cell *matHeaderCellDef>Strength</th>
                                  <td mat-cell *matCellDef="let element"> {{element.strength}} </td>
                                </ng-container>
                            
                                <ng-container matColumnDef="cost">
                                  <th mat-header-cell *matHeaderCellDef>Cost</th>
                                  <td mat-cell *matCellDef="let element"> {{element.cost}} </td>
                                </ng-container>
                              
                                <ng-container matColumnDef="quantity">
                                  <th mat-header-cell *matHeaderCellDef>Quantity</th>
                                  <td mat-cell *matCellDef="let element"> {{element.quantity}} </td>
                                </ng-container>

                                <ng-container matColumnDef="edit">
                                    <th mat-header-cell *matHeaderCellDef>Edit</th>
                                    <td mat-cell *matCellDef="let element" (click)="selectedDrug=element"><mat-icon>create</mat-icon></td>
                                  </ng-container>
                                  <ng-container matColumnDef="form">
                                      <th mat-header-cell *matHeaderCellDef>Form</th>
                                      <td mat-cell *matCellDef="let element"> {{element.form}} </td>
                                </ng-container>  
                                <ng-container matColumnDef="delete">
                                    <th mat-header-cell *matHeaderCellDef>Delete</th>
                                    <td mat-cell *matCellDef="let element" (click)="deleteMedicine(element)"> <mat-icon color="warn">delete_sweep</mat-icon></td>
                              </ng-container> 
                                
                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                              </table>
                          </div>
                        </div>
                        
                     </mat-card>
                  </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-sm-12">
                       <mat-card>
                         <mat-card-title>Procedures
                         </mat-card-title>
                         <div class="row">
                            <div class="col-sm-3">
                              <mat-form-field>
                                
                                <input type="text" matInput (typeaheadOnSelect)="onProcedure($event)" name="test"
                                placeholder="Procedure" typeaheadOptionField="name" [(ngModel)]="selectedOption.name"
                                [typeahead]="services" [typeaheadOptionsLimit]="7"
                                (typeaheadLoading)="searchProcedure(selectedOption.name)">
                                <button mat-button *ngIf="selectedOption.name" matSuffix mat-icon-button aria-label="Clear" (click)="selectedOption.name=''">
                                    <mat-icon>close</mat-icon>
                                  </button>
                              </mat-form-field>
                            </div>
                            <div class="col-sm-2">
                               <mat-form-field>
                                 <input type="text" matInput  [(ngModel)]="selectedOption.code" placeholder="Loinc Code" readonly>
                               </mat-form-field>
                             </div>
                             <div class="col-sm-2">
                                <mat-form-field>
                                  <input type="text" matInput  [(ngModel)]="selectedOption.cost" placeholder="Cost" readonly>
                                </mat-form-field>
                              </div>
                          
                             <!-- <div class="col-sm-2">
                                 <mat-form-field>
                                   <input type="text" matInput  [(ngModel)]="selectedOption.surgeon" placeholder="Surgeon Name">
                                   <button mat-button *ngIf="selectedOption.surgeon" matSuffix mat-icon-button aria-label="Clear" (click)="selectedOption.surgeon=''">
                                      <mat-icon>close</mat-icon>
                                    </button>
                                 </mat-form-field>
                               </div>
                               <div class="col-sm-2">
                                   <mat-form-field>
                                     <input type="text" matInput  [(ngModel)]="selectedOption.assistant" placeholder="Assistant Surgeon Name">
                                     <button mat-button *ngIf="selectedOption.assistant" matSuffix mat-icon-button aria-label="Clear" (click)="selectedOption.assistant=''">
                                        <mat-icon>close</mat-icon>
                                      </button>
                                   </mat-form-field>
                                 </div> -->
                                 <div class="col-sm-1">
                                    <button mat-mini-fab  [disabled]="!selectedOption.name" (click)="addProcedure()"> <i class="fa fa-plus"></i> </button>
                                </div>
                      </div>
                      
                          <div class="row" *ngIf="procedures.length">
                            <div class="col-sm-12">
  
                              <table mat-table [dataSource]="dataSource1" class="mat-elevation-z8">
  
                                  <ng-container matColumnDef="name">
                                    <th mat-header-cell *matHeaderCellDef>Name</th>
                                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                                  </ng-container>
                                  <ng-container matColumnDef="code">
                                      <th mat-header-cell *matHeaderCellDef>Code</th>
                                      <td mat-cell *matCellDef="let element"> {{element.code}} </td>
                                    </ng-container>
                                
                              
                                  <ng-container matColumnDef="cost">
                                    <th mat-header-cell *matHeaderCellDef>Cost</th>
                                    <td mat-cell *matCellDef="let element"> {{element.cost}} </td>
                                  </ng-container> 
                                  <ng-container matColumnDef="delete">
                                      <th mat-header-cell *matHeaderCellDef>Delete</th>
                                      <td mat-cell *matCellDef="let element" (click)="deleteProcedure(element)"> <mat-icon color="warn">delete_sweep</mat-icon></td>
                                </ng-container> 
                                  
                                  <tr mat-header-row *matHeaderRowDef="serviceColumns"></tr>
                                  <tr mat-row *matRowDef="let row; columns: serviceColumns;"></tr>
                                </table>
                            </div>
                          </div>
                          
                       </mat-card>
                    </div>
                  </div>
                  <br>
              <div class="row">
                <br>
                  <div class="col-sm-12">
                      <button mat-raised-button  class="pull-right btn btn-success" (click)="onSubmit()"> <i class="fa fa-check"></i> Submit</button>
                    </div>
              </div>
          </mat-step>
        
          <ng-template matStepperIcon="phone">
            <mat-icon>call_end</mat-icon>
          </ng-template>
          <ng-template matStepperIcon="chat">
            <mat-icon>forum</mat-icon>
          </ng-template>
        </mat-horizontal-stepper>
  </div>
</div>
