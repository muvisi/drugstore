
   

    <div class="card">
      <div class="card-header">
        CREATE APPOINTMENT
        <button  class="btn btn-success  btn-sm pull-right" (click)="mpesa()">Mpesa STK</button>
      </div>
      <div class="card-body">
        
              <div class="row">
              <div class="col-sm-12">
              
              <div class="row">
              <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
                <div class="col-sm-12">
                  <div class="row">
      
      <div class="col-sm-6">
        <fieldset>
          <legend>Priority</legend>
          <div class="row">
            <div class="col-sm-12" style="font-family: lato light">
              <mat-radio-group formControlName="priority" >
            <div class="row" >
              <div class="col-sm-4" style="font-family: lato light">
                <mat-radio-button value="3" checked>Normal</mat-radio-button>
              </div>
            
              <div class="col-sm-4" style="font-family: lato light">
                <mat-radio-button value="2">Vip</mat-radio-button>
              </div>
        
            </div>
          </mat-radio-group>
        </div>
          </div>
        </fieldset>
      </div>
      <div class="col-sm-6">
        <fieldset>
          <legend>Gender</legend>
          <div class="row">
            <div class="col-sm-12">
              <mat-radio-group  formControlName="gender">
                <div class="row" >
                   <div class="col-sm-4">
                       <mat-radio-button  value="Male"  style="font-family: lato light" ><b>Male</b></mat-radio-button>
                     </div>
                     <div class="col-sm-4">
                         <mat-radio-button value="Female"  style="font-family: lato light" checked><b>Female</b></mat-radio-button>
                       </div>
                       <div class="col-sm-4">
                        <mat-radio-button value="Other"  style="font-family: lato light"><b>Other</b></mat-radio-button>
                      </div>
                </div>

               </mat-radio-group>
            </div>
          </div>
        </fieldset>
      </div>
      <br>
      <br>
      <div class="col-sm-12" style="margin-top: 10px;"> 
        <fieldset>
          <legend>Background Information</legend>
          <div class="row">
            <div class="col-sm-3">
              <div class="col-sm-12">
                <mat-form-field appearance="outline">
                  <mat-label>Surname</mat-label>
                    <input matInput placeholder="Surname" formControlName="last_name">
                    <mat-error *ngIf="f.last_name.errors && submitted">Surname <strong>required</strong></mat-error>
                  </mat-form-field>
            </div>
                
              <div class="col-sm-12">
                <mat-form-field appearance="outline">
                  <mat-label>First Name</mat-label>
                    <input matInput placeholder="First Name" formControlName="first_name">
                    
                    <mat-error *ngIf="f.first_name.errors && submitted">First Name <strong>required</strong></mat-error>
                  </mat-form-field>
            </div>
            <div class="col-sm-12">
                <mat-form-field appearance="outline">
                  <mat-label>Middle Name</mat-label>
                    <input matInput placeholder="Middle Name" formControlName="other_names">
                   
                    <mat-error *ngIf="f.other_names.errors && submitted">Middle Name <strong>required</strong></mat-error>
                  </mat-form-field>
            </div>
          
            </div>
            <div class="col-sm-3">
              <div class="col-sm-12">
                <mat-form-field appearance="outline">
                  <mat-label>D.O.B</mat-label>
                    <input matInput placeholder="Date of Birth" [max]="dobDate" formControlName="dob" [matDatepicker]="picker">
                    <mat-error *ngIf="f.dob.errors && submitted">Date of birth <strong>required</strong></mat-error>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
            </div> 
              <div class="col-sm-12">
                <mat-form-field appearance="outline">
                  <mat-label>Code</mat-label>
                  <mat-select  formControlName="code">
                    <mat-option value="+254">+254</mat-option>
                    <mat-option value="+255">+255</mat-option>
                    <mat-option value="+252">+252</mat-option>
                    <mat-option value="+256">+256</mat-option>
                    <mat-option value="+249">+249</mat-option>

                  </mat-select>
                </mat-form-field>
              </div>
            <div class="col-sm-12">
              <mat-form-field  appearance="outline">
                <mat-label>Phone</mat-label>
                  <input matInput placeholder="7203022331" formControlName="phone" type="number">
                  <mat-error *ngIf="f.phone.errors && submitted">Phone <strong>required</strong></mat-error>

                </mat-form-field>
             </div>
     
       
        
          </div>
          <div class="col-sm-3">
            <div class="col-sm-12">
              <mat-form-field appearance="outline">
                <mat-label>Identity Document</mat-label>
                <mat-select formControlName="doc_type">
                  <mat-option  value="ID">
                  National ID
                  </mat-option>
                  <mat-option  value="Passport">
                  Passport
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="f.doc_type && submitted">Document Type <strong>required</strong></mat-error>
              </mat-form-field>
            </div>
             <div class="col-sm-12" *ngIf="f.doc_type.value =='ID'">
                 <mat-form-field appearance="outline">
                  <mat-label>National ID</mat-label>
                     <input matInput placeholder="National ID" formControlName="national_id">
                     <mat-error *ngIf="f.national_id.errors && submitted">National ID <strong>required</strong></mat-error>
                   </mat-form-field>
             </div> 
             <div class="col-sm-12"  *ngIf="f.doc_type.value =='Passport'">
                 <mat-form-field appearance="outline" >
                  <mat-label>Passport</mat-label>
                     <input matInput placeholder="Passport No" formControlName="passport_no">
                     <mat-error *ngIf="f.passport_no.errors && submitted">Passport <strong>required</strong></mat-error>
                   </mat-form-field>
             </div>
             <div class="col-sm-12">
               <mat-form-field appearance="outline">
                <mat-label>Email</mat-label>
                   <input matInput placeholder="Email" formControlName="email">
                   <mat-error *ngIf="f.email.errors && submitted">Valid email <strong>required</strong></mat-error>
                 </mat-form-field>
           </div>
            
          </div>
          <div class="col-sm-3">
         
            <div class="col-sm-12">
              <mat-form-field appearance="outline">
                <mat-label>Residence</mat-label>
                  <input matInput placeholder="Residence" formControlName="residence">
                </mat-form-field>
          </div> 
          <div class="col-sm-12">
              <mat-form-field appearance="outline">
                <mat-label>Occupation</mat-label>
                  <input matInput placeholder="Occupation" formControlName="occupation">
                </mat-form-field>
          </div> 
         </div>
          </div>
        </fieldset>
      </div>
      <div class="col-sm-12" style="margin-top: 20px;">
        <fieldset>
          <legend>Appointment Details</legend>
          <div class="col-sm-12">
            <div class="row">
                <div class="col-sm-2">
                  
                    <mat-form-field appearance="outline">
                      <mat-label>Appointment Date</mat-label>
                        <input matInput placeholder="Appointment Date" [min]="maxDate" formControlName="date" [matDatepicker]="picker1">
                        <mat-error *ngIf="f.date.errors && submitted">Appointment Date <strong>required</strong></mat-error>
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                      </mat-form-field>
                </div>
                <div class="col-sm-2">
                  <!-- <mat-form-field appearance="outline">
                    <mat-label>Appointment Time</mat-label>
                    <mat-select formControlName="time">
                      <mat-option *ngFor="let item of time" [value]="item">
                        {{item}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="f.time && submitted">Appointment Time <strong>required</strong></mat-error>

                  </mat-form-field> -->
                  <mat-form-field appearance="outline">
                    <mat-label>Appointment Time</mat-label>
                    <input matInput placeholder="Time" formControlName="time"  data-clocklet="class-name: my-clocklet-style;format:HH:mm;placement: top">
                    <mat-error *ngIf="f.time && submitted">Appointment Time <strong>required</strong></mat-error>

                  </mat-form-field>
                </div>
                <div class="col-sm-2">
                  <mat-form-field appearance="outline">
                    <mat-label>Appointment Type</mat-label>
                    <mat-select formControlName="type"  (selectionChange)="appointmentTypeSelected($event.value)">
                      <mat-option  *ngFor="let item of counsellling_type" [value]="item.value">
                        {{item.type}}
                      </mat-option>
                                            
                    </mat-select>
                    <mat-error *ngIf="f.type && submitted">Appointment Type <strong>required</strong></mat-error>
                  </mat-form-field>
                </div>
                <div class="col-sm-2" *ngIf="!student">
                  <mat-form-field appearance="outline">
                    <mat-label>Payment Type</mat-label>
                    <mat-select formControlName="payment_type">
                      <mat-option  value="Cash">
                      Cash
                      </mat-option>
                      <mat-option  value="Mpesa">
                      Mpesa
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="f.payment_type && submitted && !student">Payment Type <strong>required</strong></mat-error>
                  </mat-form-field>
                </div>
                <div class="col-sm-2" *ngIf="f.payment_type.value == 'Mpesa' && !student" >
                
                  <mat-form-field appearance="outline" >
                    <mat-label>Transaction No</mat-label>
                      <input matInput placeholder="Transaction No" [typeahead]="transactions"  typeaheadOptionField="phone_number" (typeaheadOnSelect)="typeaheadOnSelect($event)"  [disabled]="f.payment_type.value == 'Cash'" (ngModelChange)="searchTransaction(f.no.value)" formControlName="no">
                      <mat-error *ngIf="f.no.errors && submitted ">Transaction no<strong>required</strong></mat-error>
                    </mat-form-field>
                </div>

                <div class="col-sm-2"  *ngIf="!student">
                  <mat-form-field appearance="outline">
                    <mat-label>Amount</mat-label>
                      <input matInput placeholder="Amount"  formControlName="amount">
                      <mat-error *ngIf="f.amount.errors && submitted">
                        <div *ngIf="f.amount.errors.required">Amount is required</div>
                        <div *ngIf="f.amount.errors.min">Minimum amount is 10/=</div>
                      </mat-error>
                    </mat-form-field>
                </div>
                <div class="col-sm-12">
                      
                  <mat-form-field  appearance="outline">
                      <mat-label>Appointment Reason</mat-label>
                      <textarea matInput cols="30" rows="5"  placeholder="Reason for Appointment" formControlName="reason"></textarea>
                  <mat-error *ngIf="f.reason && submitted">Reason for Appointment <strong>required</strong></mat-error>
                    </mat-form-field>
              </div>
            </div>
        </div>
        </fieldset>
      </div>
    </div>
                </div>
                
              
                 
                  <div class="col-sm-12">
                          <br>
                      <button class="btn btn-success pull-right"> Book Appointment</button>
                  </div>
              </form>
              </div>
              </div>
            
              </div>
      </div>
    </div>

    <div class="modal fade" bsModal #staticModal="bs-modal" [config]="{backdrop: 'static'}"
    tabindex="-1" role="dialog" aria-labelledby="dialog-static-name">
 <div class="modal-dialog modal-md">
   <div class="modal-content">
     <div class="modal-header">
       <h5 id="dialog-static-name" class="modal-title pull-left">Mpesa Payment Request</h5>
       <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="staticModal.hide()">
         <span aria-hidden="true" class="visually-hidden">&times;</span>
       </button>
     </div>
     <div class="modal-body">
       <form [formGroup]="paymentForm" (ngSubmit)="onPayment()">
         <div class="row">
             <div class="col-sm-12">
                 <mat-form-field appearance="outline">
                     <mat-label>Phone Number</mat-label>
                     <input matInput placeholder="Phone Number" formControlName="mobile" >
                     <mat-error *ngIf="p.mobile?.errors && submitted">Mobile <strong>required</strong></mat-error>

                   </mat-form-field>
             </div>
             
             <div class="col-sm-12">
                 <mat-form-field appearance="outline">
                   <mat-label>Amount</mat-label>
                     <input matInput placeholder="Amount" type="number" formControlName="amount" readonly>
                     <!-- <mat-error *ngIf="p.amount.errors && submitted">
                       <div *ngIf="p.amount?.errors">Amount is required</div>
                       <div *ngIf="p.amount.errors.min">Minimum amount is 10/=</div>
                     </mat-error> -->
                   </mat-form-field>
               </div>
             <div class="col-sm-12" style="text-align: center;">
               <button class="btn btn-success btn-sm" [disabled]="paymentForm.invalid">Submit</button>
             </div>
           
         </div>
       </form>
     </div>
   </div>
 </div>
</div>

    <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '9px' }"></ngx-loading>
