<div class="card" *ngIf="!loading">
<h5 class="card-header"> <i class="icon-chart text-success"></i>  Reports</h5>
<div class="card-body">
    <mat-tab-group>
      <mat-tab>
        <ng-template mat-tab-label>
          Graphical Reports
        </ng-template>
        <br>
        <div class="row container-fluid">
          <div class="col-sm-5" *ngIf="(data | keyvalue)?.length">
                  <fusioncharts
                  [height]="height"
                  type="bar2d"
                  width="100%"
                  [dataFormat]="dataFormat"
                  [dataSource]="data"
                >
                </fusioncharts>
          </div>
          <div class="col-sm-7" *ngIf="(visits| keyvalue)?.length">
                  <fusioncharts
                  [height]="height"
                  type="column2d"
                  width="100%"
                  [dataFormat]="dataFormat"
                  [dataSource]="visits"
                >
                </fusioncharts>
          </div>
          <!-- <div class="col-sm-4" *ngIf="(gender| keyvalue)?.length">
                  <fusioncharts
                  [height]="height"
                  width="100%"
                  type="pie2d"
                  [dataFormat]="dataFormat"
                  [dataSource]="gender"
                >
                </fusioncharts>
          </div>
           -->
           <div class="col-sm-12"  *ngIf="(profit| keyvalue)?.length">
            <fusioncharts
            width="100%"
            height="400"
            type = "mscombi2d"
            [dataFormat]="dataFormat"
            [dataSource]="profit">
          </fusioncharts>
    </div>
      </div>
      
      </mat-tab>
    
      <mat-tab>
        <ng-template mat-tab-label>
          Cash Reports
        </ng-template>
        <br>
      <div class="row container-fluid">
          <div class="col-sm-3">
            <mat-form-field class="example-full-width">
              <mat-label>Phone Number</mat-label>
                <input matInput placeholder="Phone Number" (keyup)="searchCashPhone($event.target.value)" >
            </mat-form-field>
        </div>
        <div class="col-sm-3">
          <mat-form-field class="example-full-width">
            <mat-label>Choose a date</mat-label>
            <input matInput [matDatepicker]="picker1" [(ngModel)]="date" (dateChange)="searchCash(date)">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field>
      </div>
      <div class="col-sm-6">
        <button class="btn btn-success btn-sm pull-right" style="margin-top: 20px;" (click)="exportAsXLSX()">Download xls</button>
      </div>
      <div class="col-sm-12">
        <div class="mat-elevation-z8 table-responsive">
          <table mat-table [dataSource]="cashSource" matSort>
            <ng-container matColumnDef="sn">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> No. </th>
              <td mat-cell *matCellDef="let element;let i=index"> {{i+1}} </td>
            </ng-container>
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Date </th>
              <td mat-cell *matCellDef="let element"> {{element.created | date}} </td>
          </ng-container>
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Amount </th>
            <td mat-cell *matCellDef="let element"> {{element.amount | number}} </td>
          </ng-container>
    
          <ng-container matColumnDef="trx">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Reciept No</th>
            <td mat-cell *matCellDef="let element"> {{element.no}} </td>
          </ng-container>
          <ng-container matColumnDef="client">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Client</th>
            <td mat-cell *matCellDef="let element" style="text-transform: capitalize;"> {{element.patient?.first_name }} {{element.patient?.last_name }} {{element.patient?.other_names }} </td>
        </ng-container>
        <ng-container matColumnDef="mobile">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Client Mobile</th>
          <td mat-cell *matCellDef="let element" style="text-transform: capitalize;"> {{element.patient?.phone }}</td>
      </ng-container>
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Cashier</th>
              <td mat-cell *matCellDef="let element" style="text-transform: capitalize;"> {{element.cashier}} </td>
            </ng-container>
        
           
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns:displayedColumns;"></tr>
          </table>
          <mat-paginator #pagination [pageSizeOptions]="[20,40]" showFirstLastButtons></mat-paginator>
        </div>
      </div>
        </div>
        <br>
      </mat-tab>

       <mat-tab>
        <ng-template mat-tab-label>
          Room Revenues
        </ng-template>
        <div class="row container-fluid">
         
        <div class="col-sm-3">
          <mat-form-field class="example-full-width">
            <mat-label>Choose a date</mat-label>
            <input matInput [matDatepicker]="picker2" [(ngModel)]="date3" (dateChange)="onRoomRevenue(date3)">
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
      </div>
        <div class="col-sm-12">
          <div class="mat-elevation-z8">
            <table mat-table [dataSource]="dataSource1" #dSort="matSort"   matSort>
                <ng-container matColumnDef="sn">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>S/No </th>
                  <td mat-cell *matCellDef="let element;let i =index"> {{i+1}} </td>
                  </ng-container>
                  <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Date </th>
                  <td mat-cell *matCellDef="let element"> {{element.date}} </td>
                  </ng-container>
                  <ng-container matColumnDef="room">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Room</th>
                    <td mat-cell *matCellDef="let element"> {{element.room.name}} </td>
                    </ng-container>
                  <ng-container matColumnDef="start">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Start</th>
                  <td mat-cell *matCellDef="let element"> {{element.start}} </td>
                  </ng-container>
                  <ng-container matColumnDef="end">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>End</th>
                  <td mat-cell *matCellDef="let element"> {{element.end}} </td>
                  </ng-container>
                  <ng-container matColumnDef="amount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Amount</th>
                    <td mat-cell *matCellDef="let element"> {{element.room.cost}} </td>
                    </ng-container>
                  <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                    <td mat-cell *matCellDef="let element">
                      <span *ngIf="element.appointment">Appointment</span>
                      <span *ngIf="!element.appointment">Room Booking</span>
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="staff">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Staff</th>
                    <td mat-cell *matCellDef="let element"> {{element.staff}} </td>
                  </ng-container>
                 
                  <tr mat-header-row *matHeaderRowDef="roomsColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns:roomsColumns;"></tr>
                </table>
          
            <mat-paginator  #pagination1 [pageSizeOptions]="[10, 20]" showFirstLastButtons></mat-paginator>
          </div>
        </div>
         </div>
         <br>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          Counselor Revenues
        </ng-template>
        <br>
        <div class="row container-fluid">
         
        <!-- <div class="col-sm-3">
          <mat-form-field class="example-full-width">
            <mat-label>Choose a date</mat-label>
            <input matInput [matDatepicker]="picker3" [(ngModel)]="date3" (dateChange)="onRoomRevenue(date3)">
            <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
            <mat-datepicker #picker3></mat-datepicker>
          </mat-form-field>
      </div> -->
      <div class="col-sm-3">
        <mat-form-field >
          <mat-label>Select Counselor</mat-label>
          <mat-select [(ngModel)]="id" (selectionChange)="onSelect(id)">
            <mat-option *ngFor="let counselor	 of counsolers" [value]="counselor.id">{{counselor.username}}</mat-option>
          </mat-select>
        </mat-form-field>
        
      </div>
        <div class="col-sm-12">
          <div class="mat-elevation-z8 table-responsive">
            <table mat-table [dataSource]="revenueSource" matSort>
                <ng-container matColumnDef="sn">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>S/N</th>
                    <td mat-cell *matCellDef="let element;let i = index"> {{i+1}} </td>
            </ng-container>
                  <ng-container matColumnDef="StartTime">
                          <th mat-header-cell *matHeaderCellDef mat-sort-header>StartTime</th>
                          <td mat-cell *matCellDef="let element"> {{element.StartTime | date:'medium'}} </td>
                  </ng-container>
              <ng-container matColumnDef="EndTime">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>EndTime</th>
                <td mat-cell *matCellDef="let element"> {{element.EndTime | date:'medium'}} </td>
              </ng-container>
        
              <ng-container matColumnDef="Client">
                <th mat-header-cell *matHeaderCellDef  mat-sort-header>Client</th>
                <td mat-cell *matCellDef="let element" style="text-transform: capitalize;"> {{element.client.first_name}} {{element.client.last_name}} {{element.client.other_names}} </td>
              </ng-container>
              <ng-container matColumnDef="national_id">
                <th mat-header-cell *matHeaderCellDef  mat-sort-header>National ID</th>
                <td mat-cell *matCellDef="let element"> {{element.client.national_id}} </td>
              </ng-container>
              <ng-container matColumnDef="phone">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Mobile Number</th>
                <td mat-cell *matCellDef="let element"> {{element.client.phone}} </td>
              </ng-container>
              <ng-container matColumnDef="Counselor">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Counselor</th>
                <td mat-cell *matCellDef="let element" [ngClass]="{'one': element.counselor.username,'two':!element.counselor.username}"> {{element.counselor.username || 'Not Assigned' | uppercase}} </td>
              </ng-container>
              <ng-container matColumnDef="supervisor">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Supervisor</th>
                <td mat-cell *matCellDef="let element" > {{element.supervisor?.username || 'None' | uppercase}} </td>
              </ng-container>
              
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Amount</th>
                <td mat-cell *matCellDef="let element"> 
                  {{element.amount_paid | number}}
                   </td>
              </ng-container>
              
              <tr mat-header-row *matHeaderRowDef="revenueColumns"></tr>
              <tr mat-row *matRowDef="let row; columns:revenueColumns;" ></tr>
            </table>
        
            <mat-paginator [pageSizeOptions]="[10,20,50]" showFirstLastButtons></mat-paginator>
          </div>
        </div>
         </div>
         <br>
      </mat-tab>
    </mat-tab-group>
                
                             
</div>
</div>
<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '9px' }"></ngx-loading>